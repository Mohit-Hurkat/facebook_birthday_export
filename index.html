<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Facebook Birthdays Export</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86389306-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-86389306-3');
  </script>
</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
    <div class="container">
      <a class="navbar-brand" href="https://deepakmahakale.in/blog">deepakmahakale.in</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Services</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Contact</a>
          </li>
        </ul>
      </div> -->
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container">
    <div class="alert alert-success" role="alert">
      Chrome extension is now available <a href="https://chrome.google.com/webstore/detail/social-birthdays-export/hhbdbekeaphpjhoadmgibhdbfehnmpdc" target="_blank">Social Birthdays Export</a>
    </div>
    <h1 class="mt-5 text-center">Facebook Birthdays Export</h1>
    <div class="row">
      <div class="col-lg-6" >
      <ol>
        <li>Login to Facebook</li>
        <li>Visit <a href="https://www.facebook.com/events/birthdays">Facebook's events page</a></li>
        <li>Scroll to the bottom of the page till you have birthdays from all the months</li>
        <li>Right click on <b>Today's Birthday</b> or <b>Upcoming Birthdays</b></li>
        <li>Select Inspect from the dropdown</li>
        <li>In html inspector right click on div with <code>id="birthdays_content"</code> and select "copy" > "Copy element"
        <br>
        <img src="https://user-images.githubusercontent.com/14993828/63705538-009e7d80-c84b-11e9-9f13-5c8da95996a0.png" width="100%" />
        </li>
        <li>Paste the content in the textarea and click <b>Process</b></li>
        <li>Import the <b>birthdays.csv</b> generated by the site to Google Calendar</li>

      </ol>
      <h3 id="steps-to-upload-csv">Steps to upload a CSV (Comma-separated values) in Google Calendar</h3>
      <ol>
        <li>Login to your Google account and visit https://calendar.google.com</li>
        <li>Click on Add other calendars (a + symbol on the left side) and select import</li>
        <br>
        <img src="https://user-images.githubusercontent.com/14993828/64938837-ca1db680-d87c-11e9-990c-f2254857c41d.png"
        />
        <br>
        <img src="https://user-images.githubusercontent.com/14993828/64938941-1b2daa80-d87d-11e9-9e0c-9de9bea688e5.png"
          />
        <li>Select the CSV file</li>
        <br>
        <img src="https://user-images.githubusercontent.com/14993828/64939002-59c36500-d87d-11e9-9f74-f11c59a72e37.png"
           />
        <li>Click import</li>
      </ol>
      </div>
      <div class="col-lg-6 text-center" id="mainDiv">

        <textarea id="FbContent" rows="15" cols="50"
                  form="FbForm" placeholder="Paste the facebook html content here.."></textarea>
        <form id="FbForm">
          <input type="submit" value="Process" class="btn-primary">
        </form>

      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.slim.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
    $('#FbForm').on('submit', function () {
      var myRegexp = /data-tooltip-content="(?<name>[a-z0-9 ]+)\((?<month>\d{1,2})\/(?<day>\d{1,2})\)"/gi
      var data = $('#FbContent').val()
      var matched_data = data.match(myRegexp);
      var csv = []
      var today = new Date();
      var current_month = today.getMonth() + 1
      var current_day = today.getDate()
      var current_year = today.getFullYear()
      csv.push(['Subject', 'Start date', 'All Day Event'])
      matched_data.forEach(function (element) {
        match = myRegexp.exec(element)
        try {
          if(match.groups){
            var group = match.groups
            var day = parseInt(group['day'])
            var month = parseInt(group['month'])
            if(month < current_month || (month == current_month && day < current_day)) {
              var year = current_year + 1
            } else {
              var year = current_year
            }
            var date = `${day}/${month}/${year}`
            csv.push([group['name'].trim() , date, 'True']);
          }
        } catch (error) {
          return false;
        }
      });
      let csvContent = "data:text/csv;charset=utf-8," + csv.map(e => e.join(",")).join("\n");
      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("class", "btn btn-success")
      link.setAttribute("download", "birthdays.csv");
      link.innerHTML = "Download CSV"
      $('#mainDiv').append(link);
      $('#FbContent').hide();
      $('#FbForm').hide();
      return false;
    });
  </script>
</body>

</html>
